---
title: "advent_of_code_2021_dec05.Rmd"
author: "Riley King"
date: "12/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  eval = TRUE,
  message = FALSE,
  warning = FALSE,
  dpi = 300,
  fig.align = "center",
  fig.width = 11,
  fig.height = 7
)
```

```{r include=FALSE}
library(tidyverse)
library(here)
library(vapoRwave)
library(patchwork)
```


# Read in Data

## Draws

```{r}
raw_tbl <- read_lines(here("dec05/input.txt")) %>%
  as_tibble()

clean_tbl <- raw_tbl %>%
  separate(col = "value", into = c("first", "second"), sep = " -> ") %>%
  separate(col = "first", into = c("x1", "y1"), sep = ",") %>%
  separate(col = "second", into = c("x2", "y2"), sep = ",") %>%
  mutate(across(is.character, as.integer))

clean_tbl
```

# Part 1

## Get Horizontal and Vertical Lines 

```{r}
hv_tbl <- clean_tbl %>%
  mutate(same = case_when(
    x1 == x2 ~ "x",
    y1 == y2 ~ "y"
  )) %>%
  filter(same != (is.na(same)))
```

## Map All Points Generated by Horizontal and Vertical Lines

```{r}
points_tbl <- hv_tbl %>%
  mutate(point = case_when(
    x1 == x2 ~ x1,
    y1 == y2 ~ y2
  )) %>%
  mutate(range = case_when(
    same == "x" ~ map2(.x = y1, .y = y2, ~ seq(from = .x, to = .y), by = 1),
    same == "y" ~ map2(.x = x1, .y = x2, ~ seq(from = .x, to = .y), by = 1)
  )) %>%
  unnest() %>%
  mutate(
    x = case_when(
      same == "x" ~ point,
      TRUE ~ range
    ),
    y = case_when(
      same == "y" ~ point,
      TRUE ~ range
    )
  )
```

## Count Points with >= 2 Lines Touching Them

```{r}
points_tbl %>%
  group_by(x, y) %>%
  count() %>%
  filter(n >= 2) %>%
  nrow()
```

The answer to Part 1 is 5698

# Part 2

```{r}
points_tbl
```

## Find Set of Diagonal Lines
```{r}
diag_tbl <- clean_tbl %>%
  mutate(same = case_when(
    x1 == x2 ~ "x",
    y1 == y2 ~ "y",
    TRUE ~ "d"
  )) %>%
  mutate(slope = (y2 - y1) / (x2 - x1)) %>%
  filter(same == "d")
```

## Convert to all Diagonal Points

```{r}
diag_points_tbl <- diag_tbl %>%
  rowwise() %>%
  mutate(
    x = map2(.x = x1, .y = x2, ~ list(seq(from = x1, to = x2)), by = slope),
    y = map2(.x = y1, .y = y2, ~ list(seq(from = y1, to = y2)), by = slope)
  ) %>%
  unnest() %>%
  unnest()

diag_points_tbl
```

## Combine with Horizontal and Orthogonal Lines Tbl and Count Points with >= 2 Lines

```{r}
diag_points_tbl %>%
  bind_rows(points_tbl) %>%
  group_by(x, y) %>%
  count() %>%
  filter(n >= 2) %>%
  nrow()
```

The answer to Part 2 is 15463

# Learnings

> *Used some trig to calculate the slope of each diag, then use that in seq()
> *Utilized list columns and nest() to execute row-wise calcs in a dataframe

# Visualization

## Prep

```{r}
bad_spots_tbl <- diag_points_tbl %>%
  bind_rows(points_tbl) %>%
  group_by(x, y) %>%
  count() %>%
  filter(n >= 2)
```

## Visualize
```{r}
clean_tbl %>%
  mutate(row_id = row_number()) %>%
  mutate(same = case_when(
    x1 == x2 ~ "x",
    y1 == y2 ~ "y",
    TRUE ~ "d"
  )) %>%
  ggplot(aes()) +
  geom_segment(aes(x = x1, xend = x2, y = y1, yend = y2, color = same, group = row_id), size = 1.1, alpha = .5) +
  geom_point(aes(x = x, y = y), data = bad_spots_tbl, alpha = .6, color = "white", size = .8) +
  labs(
    x = "",
    y = "",
    title = "Diagonal and Orthoganal Hydrothermal Vents on the Ocean Floor ",
    subtitle = "White points indicate dangerous locations where 2 or more vents overlap",
    color = ""
  ) +
  new_retro() +
  theme(legend.position = "none")
```
